# 前端内容加载失败根因报告（WebUI 黑屏/空白）

## 1. 现象描述

- 访问 WebUI：`http://127.0.0.1:9621/webui/`
- 页面表现为黑屏/空白（仅背景色），无交互组件渲染。

## 2. 系统性定位步骤（可复用）

### 2.1 浏览器控制台

1. 打开 DevTools -> Console
2. 重点关注：
   - `Uncaught` / `SyntaxError` / `TypeError`
   - `Failed to load resource` / `net::ERR_*`
   - CSP / MIME 类型报错

### 2.2 网络面板（最关键）

1. 打开 DevTools -> Network
2. 勾选 Disable cache（仅诊断阶段）
3. 刷新页面（Ctrl+R / Ctrl+F5）
4. 检查：
   - `index.html` 是否 200
   - `*.css` / `*.js` 是否 200（尤其是入口 JS）
   - 是否存在 `/webui/assets/*` 的 404/500

### 2.3 验证 HTML 入口是否引用了不存在的构建产物

1. 打开后端挂载目录的入口文件：
   - [`lightrag/api/webui/index.html`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag/api/webui/index.html)
2. 关注其中的 `src="/webui/assets/xxxx.js"` 与 `href="/webui/assets/xxxx.css"`
3. 校验磁盘产物是否存在：
   - `lightrag/api/webui/assets/` 下应有大量 `*.js/*.css/*.woff2` 等文件

### 2.4 验证路由是否匹配访问路径

- 本项目 WebUI 使用 hash 路由，正常落点为 `/webui/#/`
- 若访问 `/webui`（无尾斜杠）或反向代理改写路径，建议统一重定向到 `/webui/` 或 `/webui/#/`

### 2.5 验证异步接口是否正常

- 后端健康检查：`GET /health`
- 若页面加载后功能异常，再继续检查：
  - `/documents/*`、`/graph*`、`/query*` 等 API 是否返回 2xx
  - 鉴权相关：`/auth-status`、`/login`

### 2.6 验证构建产物与语法

- WebUI 构建：`cd lightrag_webui && bun run build`
- Python 语法快速检查：`uv run python -m compileall -q lightrag`

### 2.7 验证端口占用与 dev/HMR

- 后端端口：默认 `9621`
- WebUI dev 端口：默认 `5173`
- HMR 链路：`GET http://127.0.0.1:5173/webui/@vite/client` 应返回 200

## 3. 本次问题证据与根因

### 3.1 证据

- `index.html` 能正常返回，但其引用的 `/webui/assets/*` 返回 404，导致入口 JS 未加载，React 未挂载，从而黑屏/空白。

### 3.2 根因

- WebUI 构建产物不完整：`lightrag/api/webui/` 下存在 `index.html`，但缺少 `assets/`（或其中缺少入口 `*.js`）。
- 后端启动时对 WebUI 的“已构建”判定仅检查 `index.html` 是否存在，未校验 `assets/` 完整性，导致误判“已构建”并挂载静态目录，最终表现为前端空白。

## 4. 修复方案

### 4.1 立即修复（让页面恢复）

1. 重新构建前端产物：
   - `cd lightrag_webui`
   - `bun install --frozen-lockfile`
   - `bun run build`
2. 确认 `lightrag/api/webui/assets/` 存在且包含入口 JS/CSS。
3. 刷新页面（建议 Ctrl+F5）。

### 4.2 代码级修复（防止再次误判）

- 已增强后端的 WebUI 构建检查：除 `index.html` 外，额外要求 `api/webui/assets` 存在且至少包含一个 `*.js`，否则提示“构建不完整”并不挂载 WebUI。
  - 参考：[lightrag_server.py](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag/api/lightrag_server.py)

## 5. 修复后验证方法（稳定性验证）

### 5.1 同浏览器验证

- 访问 `http://127.0.0.1:9621/webui/`，确认页面组件正常渲染
- DevTools -> Network 检查 `*.js/*.css` 均为 200
- DevTools -> Console 无红色报错

### 5.2 清缓存验证

- Ctrl+F5 强刷
- 或 DevTools 打开时按住刷新按钮选择 “Empty Cache and Hard Reload”

### 5.3 多浏览器验证（建议）

- Chrome / Edge / Firefox 任意两种交叉验证是否稳定加载
- 若反向代理/HTTPS 场景，额外验证：
  - Mixed Content
  - CSP
  - gzip/brotli 与缓存策略

### 5.4 dev/HMR 验证（可选）

- `http://127.0.0.1:5173/webui/` 可加载
- `/webui/@vite/client` 返回 200
- 修改任一 `lightrag_webui/src` 文件后页面能自动刷新或局部热更新

## 6. 预防措施

- 启动前强制执行构建：
  - 使用统一脚本（例如 `scripts/start.ps1` / `scripts/bootstrap.ps1`）在启动后端前先构建 WebUI
- CI 增加一致性检查：
  - WebUI build 后校验 `lightrag/api/webui/assets` 存在且入口文件可访问
  - 后端 `python -m compileall` 作为基础语法检查
- 运行时自检：
  - 后端启动时若检测到 WebUI 不完整，明确输出警告与修复命令，避免“黑屏但无提示”的体验

