# 启动流程（开发/测试/生产）

## 1. 技术栈概览

### 后端
- 语言/运行时：Python >= 3.10（项目声明），本机可用 Python 3.12 也可运行
- Web 框架：FastAPI（服务入口：`lightrag-server`）
- ASGI Server：Uvicorn（Windows 推荐），Gunicorn（Linux 生产可选）
- 依赖管理：uv（推荐），也可用 pip
- 关键目录
  - API 服务：[`lightrag/api`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag/api)
  - 服务入口：[`pyproject.toml`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/pyproject.toml) 中的 `lightrag-server = "lightrag.api.lightrag_server:main"`
  - 健康检查：[`lightrag_server.py`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag/api/lightrag_server.py) 的 `/health`

### 前端（官方 WebUI）
- 框架：React + Vite + TypeScript
- 包管理：Bun（推荐），也提供 no-bun scripts（需 Node + Vite）
- 构建产物输出：Vite build 输出到后端静态目录 `lightrag/api/webui`
  - 见 [`lightrag_webui/vite.config.ts`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag_webui/vite.config.ts)
- 关键目录：[`lightrag_webui`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag_webui)

## 2. 统一配置原则（.env / 端口 / 工作目录）

### .env 放置规则
- 后端每次启动都会从“当前工作目录”的 `.env` 加载配置（且系统环境变量优先于 `.env`）
- 标准做法：在仓库根目录放置 `.env`，并从该目录启动服务
  - 示例模板：[`env.example`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/env.example)

### 默认端口
- 后端：`9621`（可通过 `PORT` 或 `--port` 修改）
- WebUI 开发服务器（Vite）：`5173`（可通过脚本参数修改）

### 默认持久化目录
- `WORKING_DIR`：默认 `./rag_storage`
- `INPUT_DIR`：默认 `./inputs`
- 可在 `.env` 里配置绝对路径以避免相对路径差异

## 3. 一键启动脚本（Windows PowerShell）

脚本目录：[`scripts`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/scripts)

### 3.1 开发模式（前后端同时启动）

```powershell
cd e:\OPC-ZCKJ\LightRAG-main\LightRAG-main
.\scripts\dev.ps1 -InitEnv
```

- WebUI：`http://localhost:5173/webui/`
- API：`http://localhost:9621`
- 健康检查：`http://localhost:9621/health`

说明
- WebUI dev 通过 Vite 代理转发 API（无需额外 CORS 配置）
- WebUI 的代理配置在 [`lightrag_webui/.env.development`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag_webui/.env.development) 与 [`lightrag_webui/env.local.sample`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag_webui/env.local.sample)

### 3.2 本地“一体化启动”（后端挂载 WebUI 静态资源）

```powershell
cd e:\OPC-ZCKJ\LightRAG-main\LightRAG-main
.\scripts\start.ps1 -InitEnv
```

- 该模式会自动构建 WebUI，并将产物输出到后端目录，随后启动 `lightrag-server`
- 访问入口：`http://localhost:9621/`（会重定向到 `/webui`）

### 3.3 生产模式（Docker Compose）

```powershell
cd e:\OPC-ZCKJ\LightRAG-main\LightRAG-main
.\scripts\prod.ps1 -InitEnv
```

- 默认 compose 文件：[`docker-compose.yml`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/docker-compose.yml)
- 若需要数据库（Postgres/Neo4j/Redis/Milvus/Qdrant/Mongo），请在 `.env` 中配置连接并自行部署对应服务

### 3.4 启动后验证

```powershell
.\scripts\verify.ps1 -BaseUrl http://localhost:9621
```

## 4. 依赖安装与构建脚本位置

### 后端依赖
- 推荐：`uv sync --extra api`（等价于安装 `.[api]`）
- 依赖声明：[`pyproject.toml`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/pyproject.toml)

### 前端依赖/构建
- 脚本与依赖声明：[`lightrag_webui/package.json`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag_webui/package.json)
- 构建输出位置：[`lightrag_webui/vite.config.ts`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/lightrag_webui/vite.config.ts)

## 5. 数据库/存储后端选择（可选）

默认情况下使用本地文件/内存型存储（适合小规模/快速验证）。若要切换为生产级存储，在 `.env` 中配置：
- `LIGHTRAG_KV_STORAGE`
- `LIGHTRAG_DOC_STATUS_STORAGE`
- `LIGHTRAG_GRAPH_STORAGE`
- `LIGHTRAG_VECTOR_STORAGE`

完整示例与默认端口见：[`env.example`](file:///e:/OPC-ZCKJ/LightRAG-main/LightRAG-main/env.example#L361-L500)

常见默认端口（供快速排障）
- Postgres：5432
- Neo4j/Memgraph Bolt：7687
- Redis：6379
- Milvus：19530
- Qdrant：6333
- MongoDB：27017

